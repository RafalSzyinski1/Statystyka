---
title: "Statystyka"
author: "Rafał Szyiński, Kajetan Leszak"
date: "`r Sys.Date()`"
output: pdf_document
---

# Statystyka

## Wstęp

```{r libs}
library(ggplot2)
library(readr)
library(dplyr)
```

## Opis baza danych

- Baza pochodzi z eportal
- Baza danych składa się z ...
- Opis poszczególnych kolumn

```{r ladowanie_bazy_danych}
data <- read.csv2("credit_card.xls");
data
```

## Wyliczenie podstawowych statystyk

Statysyka będzie wyliczona z columny items i spent

```{r statystyka_items_i_spent}
frame <- data.frame(
  items_summary=unclass(summary(data$items)),
  spent_summary=unclass(summary(data$spent))
  )
frame
```

## Wykresy

```{r plot_box}
ggplot() + 
  geom_bar(
    data=data, 
    aes(x=type_trans, y=items, color=gender, fill=gender), 
    stat="identity"
    ) +
  labs(
    title="Wykres słupkowy dla zakupu rodzaju dobra w zależności od płci",
    x="Rodzaj dobra",
    y="Sumaryczna ilość zakupionych produktów"
    ) +
  theme_classic()
```

```{r plot_linear}
# Filtrujemy wysztkie dane pierwszego użytkownika
user_data <- data[data$custid == "8257-BKBEDP-MRF",]

month_numeric <- c("January", "February", "March", "April","May", "June", "July", "August", "September", "October", "November", "December" )

# Zamiana miesiąca z słowa na liczbe np. January=1
month <- match(user_data$month, month_numeric)

user_date_spent = data.frame(
  year = user_data$year,
  month = month,
  spent = user_data$spent
  )

# Sortowanie po roku i miesiącu
sorted_user <- user_date_spent[order(user_date_spent$year, user_date_spent$month),]
# Sumaryczny wektor 
sorted_user$spent <- cumsum(sorted_user$spent)
data_length = length(sorted_user$spent)

ggplot() +
  geom_line(
    data=sorted_user, 
    aes(x = seq(from=1, to=data_length), y = spent),
    color = "chartreuse3",
    linewidth = 1
    ) + 
  scale_x_continuous(
    breaks= seq(from=1, to=data_length, by=5), 
    labels=c(paste(rep(2007, 12), month_numeric, sep="-"), paste(rep(2008, 12), month_numeric, sep="-"))
    ) +
  labs(
    title = "Wydatki użytkownika 8257-BKBEDP-MRF względem czasu",
    x = NULL,
    y = "Sumaryczne wydatki"
  ) +
  theme(axis.text.x = element_text(angle = 30, hjust = 0.5, vjust = 0.5))

```

```{r plot_histogram}
# TODO: label
ggplot() +
  geom_histogram(data=data, aes(x=card), stat="count")

```

## Obserwacje odstające

Będziemy obserwować wydatki osób w zależności od ich wieku

### Przygotowanie danych

```{r data_prep}
user_data = 
  data.frame(year=data$birth_year, spent=data$spent) %>%
  group_by(year) %>% 
  summarize(
    total_spent=sum(spent),
    q1 = quantile(spent, 0.25),
    median = median(spent),
    q3 = quantile(spent, 0.75),
    lower_whisker = max(min(spent), q1 - 1.5 * IQR(spent)),
    upper_whisker = min(max(spent), q3 + 1.5 * IQR(spent)),
    mean = mean(spent),
    sd = sd(spent)
  )

user_data
```

### Wykres pudełko-wąsy

```{r values}
outliers_1929 <- data[data$birth_year == 1929,]$spent
outliers_1929 <- outliers_1929[outliers_1929 > user_data[user_data$year == 1929,]$upper_whisker]
outliers_1929
```

```{r plot_boxwhisker}
# TODO: opisac
ggplot() +
  geom_boxplot(data=data, aes(x=birth_year, y=spent, group=birth_year)) +
  theme_bw()
```

### Odchylenie standardowe

```{r plot_density}
# TODO: wyliczyc i wyrysować dla 1929
spent = data[data$birth_year == 1929,]$spent

spent
a <- dnorm(spent, user_data$mean, user_data$sd)
ggplot() +
  geom_line(data=data.frame(x=spent, y=a), aes(x, y))

```